<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Discord æŒ‰éˆ•ç·¨è¼¯æ–‡å­—æ ¼å¼</title>
    <link rel="icon" type="image/png" href="logo.png">
    <style>
        :root {
            --discord-bg: #36393f;
            --discord-text: #dcddde;
            --discord-primary: #5865f2;
            --discord-secondary: #4f545c;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--discord-bg);
            background-image: url('backimage.png');
            background-position: center;
            background-repeat: no-repeat;
            background-size: cover;
            background-attachment: fixed;
            color: var(--discord-text);
            margin: 0;
            padding: 10px;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            position: relative;
        }

        /* æ·»åŠ ä¸€å€‹åŠé€æ˜çš„é®ç½©å±¤ */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(54, 57, 63, 0.85); /* Discord èƒŒæ™¯è‰²é…åˆé€æ˜åº¦ */
            z-index: -1;
        }

        /* ç¢ºä¿æ‰€æœ‰å…§å®¹åœ¨é®ç½©å±¤ä¸Šæ–¹ */
        .main-container,
        h1,
        .stats-bar,
        .footer {
            position: relative;
            z-index: 1;
        }

        h1 {
            color: var(--discord-text);
            margin-bottom: 5px;
            font-size: 2em;
            text-align: center;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
            padding: 10px 0;
        }

        .subtitle {
            color: #00b0f4; /* Discord è—è‰² */
            margin-bottom: 15px;
            font-size: 1em;
            text-align: center;
            font-weight: 600;
            padding: 5px 15px;
            background-color: rgba(0, 176, 244, 0.1);
            border-radius: 6px;
            border: 1px solid rgba(0, 176, 244, 0.2);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            animation: pulse 2s infinite;
            display: inline-block;
        }

        @keyframes pulse {
            0% {
                box-shadow: 0 0 0 0 rgba(0, 176, 244, 0.4);
            }
            70% {
                box-shadow: 0 0 0 10px rgba(0, 176, 244, 0);
            }
            100% {
                box-shadow: 0 0 0 0 rgba(0, 176, 244, 0);
            }
        }

        .main-container {
            width: 100%;
            max-width: 1400px;
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
            align-items: flex-start;
            position: relative;
        }

        .button-section {
            flex: 0 0 200px;
            padding: 15px;
            background: rgba(32, 34, 37, 0.3);
            border-radius: 8px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            max-height: 400px; /* è¨­å®šæœ€å¤§é«˜åº¦ */
            overflow-y: auto; /* æ·»åŠ å‚ç›´æ»¾å‹• */
        }

        .button-section h2 {
            color: #00b0f4;
            margin: 0 0 15px 0;
            font-size: 1.2em;
            text-align: center;
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .button-group-container {
            display: flex;
            flex-direction: column;
            gap: 10px;
            overflow-y: visible; /* ç¢ºä¿æŒ‰éˆ•å®¹å™¨å…§å®¹å¯ä»¥å®Œæ•´é¡¯ç¤º */
        }

        .button-container button {
            width: 100%;
            text-align: center;
            background-color: #2f3136;
            color: #ffffff;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        .button-container button:hover {
            background-color: #5865f2;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
        }

        .center-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: stretch;
            min-width: 300px;
        }

        .editor-wrap {
            width: 100%;
            background: #2f3136;
            border-radius: 4px;
            border: 1px solid var(--discord-secondary);
            display: flex;
            height: 400px;
            overflow: hidden;
            position: relative;
        }

        .editor-content {
            flex: 1;
            position: relative;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }
        #textArea::-webkit-scrollbar-corner {
          background-color: transparent;
        }

        #textArea {
            width: 100%;
            height: 100%;
            margin: 0;
            padding: 0 12px;
            border: none;
            background: transparent;
            color: var(--discord-text);
            font-family: Consolas, 'Courier New', monospace;
            font-size: 14px;
            line-height: 21px;
            resize: none;
            outline: none;
            overflow-y: scroll;
            box-sizing: border-box;
            white-space: pre-wrap;
            word-wrap: break-word;
            overflow-x: scroll;
            tab-size: 4;
        }

        /* è‡ªå®šç¾©æ»¾å‹•æ¢æ¨£å¼ */
        #textArea::-webkit-scrollbar {
            width: 8px;
        }

        #textArea::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.1);
            border-radius: 4px;
        }

        #textArea::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 4px;
        }

        #textArea::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        /* é«˜äº®æ•ˆæœ */
        .highlight-line {
            background-color: rgba(255, 255, 255, 0.05);
        }

        /* è¡Œæ‡¸åœæ•ˆæœ */
        .line-hover {
            position: absolute;
            left: 0;
            width: 100%;
            height: 21px;
            background-color: rgba(255, 255, 255, 0.05);
            pointer-events: none;
        }

        .modal {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: var(--discord-bg);
            padding: 20px;
            border-radius: 4px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
            z-index: 1000;
        }

        .modal input {
            width: 100%;
            padding: 8px;
            margin: 10px 0;
            background-color: #40444b;
            color: var(--discord-text);
            border: 1px solid var(--discord-secondary);
            border-radius: 4px;
        }

        .modal-buttons {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }

        /* é€šçŸ¥æ¨£å¼ */
        #toast {
            visibility: hidden;
            position: fixed;
            top: 20px;
            right: 20px;
            min-width: 200px;
            color: #fff;
            text-align: center;
            border-radius: 4px;
            padding: 16px;
            z-index: 1000;
            font-size: 14px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }

        #toast.success {
            background-color: #43b581;
        }

        #toast.warning {
            background-color: #f04747;
        }

        #toast.show {
            visibility: visible;
            animation: fadein 0.3s, fadeout 0.3s 1.7s;
        }

        @keyframes fadein {
            from {opacity: 0;}
            to {opacity: 1;}
        }

        @keyframes fadeout {
            from {opacity: 1;}
            to {opacity: 0;}
        }

        /* é¸å–æ¨£å¼ */
        #textArea::selection {
            background-color: rgba(0, 120, 215, 0.6);
            color: white;
        }

        /* è¡Œè™Ÿé¸å–æ¨£å¼ */
        .line-numbers div:hover {
            background-color: #2a2d2e;
        }

        .button-group {
            width: 100%;
            display: flex;
            gap: 20px;
            margin-top: 10px;
            justify-content: flex-end;
        }

        .action-button {
            min-width: 100px;
            padding: 10px 20px;
            background-color: #40444b;
            color: var(--discord-text);
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        .action-button:hover {
            background-color: #5865f2;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
        }

        .action-button.clear {
            background-color: #5f0002; /* æš—ç´…è‰² */
            color: var(--discord-text); /* å¦‚æœéœ€è¦å¯ä»¥æ”¹æˆç™½è‰²ï¼š#ffffff */
            margin-right: auto;
         }
         .action-button.clear:hover {
            background-color: #230001; /* æ‡‰ç”¨åœ¨æ‡¸åœæ™‚ */
        }

        /* é‡å°å…©å´æŒ‰éˆ•å€å¡Šå…§çš„æŒ‰éˆ•ï¼ˆä½æ–¼ .button-group-container ä¸­ï¼‰ */
.button-group-container button {
    width: 100%;
    background-color: rgba(32,34,37,0.3);  /* èˆ‡å®¹å™¨ç›¸åŒçš„èƒŒæ™¯è‰² */
    color: #ffffff;                         /* ç™½è‰²æ–‡å­— */
    border: 1px solid rgba(255,255,255,0.1);  /* è¼•å¾®çš„é‚Šæ¡† */
    padding: 8px 16px;
    border-radius: 4px;
    cursor: pointer;
    transition: all 0.2s;
}

.button-group-container button:hover {
    background-color: rgba(32,34,37,0.5);  /* æ‡¸åœæ™‚åŠ æ·±èƒŒæ™¯è‰² */
}

        /* é è¨­æ¨£å¼ï¼ˆå¤§è¦–çª—ï¼‰ */
        .menu-toggle {
            display: none;
        }

        .button-section {
            flex: 0 0 200px;
            padding: 15px;
            background: rgba(32, 34, 37, 0.3);
            border-radius: 8px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            max-height: 400px; /* è¨­å®šæœ€å¤§é«˜åº¦ */
            overflow-y: auto; /* æ·»åŠ å‚ç›´æ»¾å‹• */
        }

        /* è‡ªå®šç¾©æ»¾å‹•æ¢æ¨£å¼ */
        .button-section::-webkit-scrollbar {
            width: 8px;
        }

        .button-section::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.1);
            border-radius: 4px;
        }

        .button-section::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 4px;
        }

        .button-section::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .button-group-container {
            display: flex;
            flex-direction: column;
            gap: 10px;
            overflow-y: visible; /* ç¢ºä¿æŒ‰éˆ•å®¹å™¨å…§å®¹å¯ä»¥å®Œæ•´é¡¯ç¤º */
        }

        /* ä¸­ç­‰è¦–çª—æ¨£å¼ */
        @media (max-width: 1200px) {
            .button-group {
                display: grid;
                grid-template-columns: repeat(2, 1fr);
                gap: 8px;
                padding: 10px;
            }

            .action-button {
                width: 100%;
                padding: 10px;
                font-size: 14px;
                margin: 0;
            }

            .action-button.clear {
                grid-column: 1 / -1;
                background-color: #5f0002;
                margin-bottom: 8px;
            }
        }

        /* çª„è¦–çª—æ¨£å¼ */
        @media (max-width: 800px) {
            .main-container {
                padding: 0 10px;
            }

            .menu-toggle {
                display: flex !important;
                position: absolute;
                padding: 8px 12px;
                background: #2f3136;
                border: 1px solid var(--discord-secondary);
                border-radius: 4px;
                cursor: pointer;
                z-index: 1000;
                color: white;
                align-items: center;
                gap: 8px;
                transition: all 0.3s ease;
                box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
            }

            .menu-toggle.left {
                left: 10px;
                top: 10px;
            }

            .menu-toggle.right {
                right: 10px;
                top: 10px;
            }

            .toggle-icon {
                font-size: 12px;
                transition: transform 0.3s;
            }

            .toggle-text {
                font-size: 14px;
                white-space: nowrap;
            }

            .menu-toggle.active .toggle-icon {
                transform: rotate(90deg);
            }

            .menu-toggle.right.active .toggle-icon {
                transform: rotate(-90deg);
            }

            .button-section {
                display: none;
                position: fixed;
                top: 45px;
                width: 200px;
                background: #2f3136;
                border: 1px solid var(--discord-secondary);
                padding: 15px;
                border-radius: 4px;
                box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
                z-index: 1001;
                max-height: calc(100vh - 60px);
                overflow-y: auto;
            }

            #leftButtonSection {
                left: 10px;
            }

            #rightButtonSection {
                right: 10px;
            }

            .button-section.active {
                display: block;
            }

            .center-content {
                margin: 50px 0 0 0;
                width: 100%;
            }

            .button-group-container {
                display: flex;
                flex-direction: column;
                gap: 5px;
            }

            .button-group-container button {
                width: 100%;
                text-align: left;
                padding: 8px 10px;
            }

            .stats-bar {
                flex-wrap: wrap;
                justify-content: center;
            }
            
            .reminder {
                width: 100%;
                text-align: center;
                margin-top: 5px;
            }

            .editor-wrap {
                height: 200px;
            }
        }

        /* æ›´çª„çš„è¦–çª—æ¨£å¼ */
        @media (max-width: 600px) {
            .main-container {
                padding: 0 5px;
            }

            .button-group {
                grid-template-columns: 1fr;
            }

            .button-section {
                width: calc(100vw - 60px); /* æ¸›å°‘å¯¬åº¦ */
                max-width: 280px; /* è¨­å®šæœ€å¤§å¯¬åº¦ */
                left: 50%;
                transform: translateX(-50%); /* æ°´å¹³ç½®ä¸­ */
            }

            #leftButtonSection,
            #rightButtonSection {
                left: 50%;
                transform: translateX(-50%);
                right: auto;
            }

            .menu-toggle {
                width: auto;
                min-width: 100px;
            }

            .menu-toggle.left {
                left: 5px;
            }

            .menu-toggle.right {
                right: 5px;
            }

            /* ç¢ºä¿æŒ‰éˆ•æ–‡å­—åœ¨çª„è¢å¹•ä¸Šä¸æœƒæ›è¡Œ */
            .button-group-container button {
                white-space: normal;
                height: auto;
                min-height: 40px;
                line-height: 1.2;
                padding: 8px;
            }
        }

        .stats-bar {
            background: rgba(32, 34, 37, 0.3);
            padding: 8px 15px;
            border-radius: 4px;
            margin: 5px 0;
            display: flex;
            gap: 20px;
            justify-content: space-between;
            font-size: 0.9em;
            color: #dcddde;
            border: 1px solid rgba(255, 255, 255, 0.1);
            align-items: center;
        }

        .time-tool-link {
            margin: 10px 0;
            text-align: center;
            padding: 10px;
            background: linear-gradient(45deg, rgba(88, 101, 242, 0.2), rgba(0, 176, 244, 0.2));
            border-radius: 8px;
            border: 1px solid rgba(88, 101, 242, 0.3);
            transition: all 0.3s ease;
        }

        .time-tool-link a {
            color: #00b0f4;
            text-decoration: none;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            transition: all 0.3s ease;
        }

        .time-tool-link:hover {
            background: linear-gradient(45deg, rgba(88, 101, 242, 0.3), rgba(0, 176, 244, 0.3));
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(88, 101, 242, 0.2);
        }

        .time-tool-link .time-icon {
            font-size: 1.2em;
            animation: pulse 2s infinite;
        }

        .time-tool-link .arrow {
            font-size: 1.2em;
            transition: transform 0.3s ease;
        }

        .time-tool-link:hover .arrow {
            transform: translateX(5px);
        }

        @keyframes pulse {
            0% { opacity: 0.6; }
            50% { opacity: 1; }
            100% { opacity: 0.6; }
        }

        .reminder {
            color: #00b0f4;
            font-weight: bold;
            margin-left: auto;
            white-space: nowrap;
        }

        .footer {
            margin-top: 30px;
            padding: 20px;
            background: rgba(32, 34, 37, 0.3);
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            text-align: center;
            font-size: 0.9em;
            color: #dcddde;
            position: relative;
            z-index: 1000;
        }

        .footer p {
            margin: 5px 0;
        }

        .footer a {
            color: #00b0f4;
            text-decoration: none;
            transition: color 0.2s;
        }

        .footer a:hover {
            color: #fff;
            text-decoration: underline;
        }

        .button-section-divider {
            padding: 10px;
            margin: 5px 0;
            background: rgba(0, 176, 244, 0.1);
            border: 1px solid rgba(0, 176, 244, 0.2);
            border-radius: 4px;
            color: #00b0f4;
            font-size: 0.9em;
            text-align: center;
        }

        .video-container {
            margin-top: 20px;
            position: relative;
            width: 100%;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 0 20px rgba(88, 101, 242, 0.4);
            background: linear-gradient(45deg, #5865f2, #00b0f4);
            padding: 3px;
        }

        .video-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(45deg, #5865f2, #00b0f4, #5865f2);
            background-size: 200% 200%;
            animation: gradient 5s ease infinite;
            z-index: -1;
            border-radius: 15px;
        }

        .video-inner {
            position: relative;
            width: 100%;
            background: #36393f;
            border-radius: 12px;
            overflow: hidden;
        }

        .video-inner video {
            display: block;
            width: 100%;
            height: auto;
        }

        @keyframes gradient {
            0% {
                background-position: 0% 50%;
            }
            50% {
                background-position: 100% 50%;
            }
            100% {
                background-position: 0% 50%;
            }
        }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.4.14/ace.js"></script>
</head>
<body>
    <h1>Discord æŒ‰éˆ•ç·¨è¼¯æ–‡å­—æ ¼å¼</h1>
    <div class="time-tool-link">
        <a href="https://hammertime.cyou/zh-TW" target="_blank">
            <span class="time-icon">âŒš</span>
            æƒ³åœ¨è¨Šæ¯ä¸­æ·»åŠ  DC æ™‚é–“èªæ³•è«‹å‰å¾€é€™
            <span class="arrow">â†’</span>
        </a>
    </div>
    
    <div class="time-tool-link">
        <a href="DC-text-color.html" target="_blank">
            <span class="time-icon">ğŸ¨</span>
            æƒ³åœ¨è¨Šæ¯ä¸­æ·»åŠ  DC æ–‡å­—é¡è‰²è«‹å‰å¾€é€™
            <span class="arrow">â†’</span>
        </a>
    </div>

    <div class="stats-bar">
        <span>ç©ºç™½å­—å…ƒï¼š<span id="whiteSpaceCount">0</span></span>
        <span>éç©ºç™½å­—å…ƒï¼š<span id="nonWhiteSpaceCount">0</span></span>
        <span>ç¸½å­—å…ƒæ•¸ï¼š<span id="totalCount">0</span></span>
        <span class="reminder">è¨˜å¾—å…ˆæ¡†é¸æ–‡å­—å†æŒ‰æŒ‰éˆ•</span>
    </div>
    
    <div class="main-container">
        <button class="menu-toggle left" id="leftMenuToggle" aria-label="åˆ‡æ›æ–‡å­—æ ¼å¼é¸å–®">
            <span class="toggle-icon">â–¶</span>
            <span class="toggle-text">æ–‡å­—æ ¼å¼</span>
        </button>
        
        <div class="button-section" id="leftButtonSection">
            <h2>æ–‡å­—æ ¼å¼</h2>
            <div class="button-group-container">
                <button onclick="addHiddenText()">éš±è—æ–‡å­—</button>
                <button onclick="addBold()">ç²—é«”</button>
                <button onclick="addItalic()">æ–œé«”</button>
                <button onclick="addStrikethrough()">åˆªé™¤ç·š</button>
                <button onclick="addCode()">ä»£ç¢¼å¡Š</button>
                <button onclick="addLink()">æ–‡å­—è¶…é€£çµ</button>
            </div>
        </div>

        <div class="center-content">
            <div class="editor-wrap">
                <div class="editor-content">
                    <textarea id="textArea" placeholder="åœ¨é€™è£¡è¼¸å…¥æ–‡å­—..."></textarea>
                </div>
            </div>
            
            <div class="button-group">
                <button class="action-button clear" onclick="clearText(event)">æ¸…ç©ºæ–‡å­—</button>
                <button class="action-button" onclick="selectAllText(event)">å…¨é¸æ–‡å­—</button>
                <button class="action-button" onclick="undoLastAction(event)">è¿”å›ä¸Šä¸€æ­¥</button>
                <button class="action-button" onclick="redoLastAction(event)">è¿”å›ä¸‹ä¸€æ­¥</button>
                <button class="action-button" onclick="copyText(event)">è¤‡è£½æ–‡å­—</button>
            </div>

            <div class="video-container">
                <div class="video-inner">
                    <video controls>
                        <source src="ç¤ºç¯„å½±ç‰‡.mp4" type="video/mp4">
                        æ‚¨çš„ç€è¦½å™¨ä¸æ”¯æ´å½±ç‰‡æ’­æ”¾ã€‚
                    </video>
                </div>
            </div>
        </div>

        <button class="menu-toggle right" id="rightMenuToggle" aria-label="åˆ‡æ›æ®µè½æ ¼å¼é¸å–®">
            <span class="toggle-icon">â—€</span>
            <span class="toggle-text">æ®µè½æ ¼å¼</span>
        </button>
        
        <div class="button-section" id="rightButtonSection">
            <h2>æ®µè½æ ¼å¼</h2>
            <div class="button-group-container">
                <button onclick="addCodeBlock()">æ›´å‡¸é¡¯ã€é›»è…¦å¯ç›´æ¥è¤‡è£½çš„ä»£ç¢¼å¡Šï¼ˆå„æ®µï¼‰</button>
                <button onclick="addCodeBlockWhole()">æ›´å‡¸é¡¯ã€é›»è…¦å¯ç›´æ¥è¤‡è£½çš„ä»£ç¢¼å¡Šï¼ˆé¸å–ç¯„åœï¼‰</button>
                <div class="button-section-divider">ä»¥ä¸‹æŒ‰éˆ•ç”¢ç”Ÿçš„ç¬¦è™Ÿè¦åœ¨å¥é¦–æ‰å¥æ•ˆ</div>
                <button onclick="addQuote()">ç¸®è¡Œå¼•ç”¨æ–‡å­—</button>
                <button onclick="addParentList()">æ¯é …ç›®æ¸…å–®ç¬¦è™Ÿ</button>
                <button onclick="addNestedList()">æ¯å­é …ç›®æ¸…å–®ç¬¦è™Ÿ</button>
                <button onclick="addNumberList()">æ•¸å­—æ¸…å–®ç¬¦è™Ÿ</button>
                <button onclick="addHeading1()">å¤§å°è®ŠåŒ–-è®Šæ›´å¤§</button>
                <button onclick="addHeading2()">å¤§å°è®ŠåŒ–-è®Šå¤§</button>
                <button onclick="addHeading3()">è®Šç²—ã€å¢åŠ è¡Œè·</button>
            </div>
        </div>
    </div>

    <div id="linkModal" class="modal">
        <h3>è¼¸å…¥é€£çµ</h3>
        <input type="text" id="linkInput" placeholder="è«‹è¼¸å…¥é€£çµ">
        <div class="modal-buttons">
            <button onclick="confirmLink()">ç¢ºå®š</button>
            <button onclick="cancelLink()">å–æ¶ˆ</button>
        </div>
    </div>

    <!-- æ·»åŠ æ•¸å­—æ¸…å–® Modal -->
    <div id="numberListModal" class="modal">
        <h3>è«‹è¼¸å…¥èµ·å§‹æ•¸å­—</h3>
        <input type="number" id="startNumber" placeholder="è«‹è¼¸å…¥æ•¸å­—" min="1" value="1">
        <div class="modal-buttons">
            <button onclick="confirmNumberList()">ç¢ºå®š</button>
            <button onclick="cancelNumberList()">å–æ¶ˆ</button>
        </div>
    </div>

    <!-- æ·»åŠ é€šçŸ¥å…ƒç´  -->
    <div id="toast"></div>

    <footer class="footer">
        <p>æœ‰ä»»ä½•ç¶²é éŒ¯èª¤æˆ– Discord å•é¡Œæ­¡è¿ä¾†ä¿¡ï¼š<a href="mailto:a052705@gmail.com">a052705@gmail.com</a></p>
    </footer>

    <script>
        let textArea = document.getElementById('textArea');
        let linkModal = document.getElementById('linkInput');
        let selectedText = '';
        let selectionStart = 0;
        let selectionEnd = 0;

        // æ’¤éŠ·åŠŸèƒ½ç›¸é—œè®Šæ•¸
        let undoStack = [''];
        let redoStack = [];
        let currentState = '';
        let isComposing = false;

        // ä¿å­˜ç‹€æ…‹
        function saveState() {
            const newText = textArea.value;
            if (newText !== currentState) {
                undoStack.push(newText);
                currentState = newText;
                redoStack = [];
                updateCharacterCount();
                
                if (undoStack.length > 100) {
                    undoStack.shift();
                }
            }
        }

        // æ’¤éŠ·
        function undoLastAction(event) {
            event.preventDefault();
            
            if (undoStack.length > 1) {
                redoStack.push(textArea.value);
                undoStack.pop();
                const previousText = undoStack[undoStack.length - 1];
                
                textArea.value = previousText;
                currentState = previousText;
                
                updateCharacterCount();
                textArea.focus();
            }
        }

        // é‡åš
        function redoLastAction(event) {
            event.preventDefault();
            
            if (redoStack.length > 0) {
                const nextText = redoStack.pop();
                undoStack.push(textArea.value);
                
                textArea.value = nextText;
                currentState = nextText;
                
                updateCharacterCount();
                textArea.focus();
            }
        }

        // æ¸…ç©ºæ–‡å­—
        function clearText(event) {
            event.preventDefault();
            
            if (textArea.value !== '') {
                saveState();
                textArea.value = '';
                saveState();
                updateCharacterCount();
                textArea.focus();
                showToast('å·²æ¸…ç©ºæ–‡å­—', 'success');
            }
        }

        // è¤‡è£½æ–‡å­—
        function copyText(event) {
            event.preventDefault();
            
            const originalStart = textArea.selectionStart;
            const originalEnd = textArea.selectionEnd;
            
            textArea.select();
            document.execCommand('copy');
            
            textArea.setSelectionRange(originalStart, originalEnd);
            textArea.focus();
            showToast('å·²è¤‡è£½æ–‡å­—ï¼', 'success');
        }

        // ç›£è½æ–‡å­—è¼¸å…¥
        textArea.addEventListener('input', function() {
            if (!isComposing) {
                saveState();
                updateCharacterCount();
            }
        });

        // ç›£è½ä¸­æ–‡è¼¸å…¥é–‹å§‹
        textArea.addEventListener('compositionstart', function() {
            isComposing = true;
        });

        // ç›£è½ä¸­æ–‡è¼¸å…¥çµæŸ
        textArea.addEventListener('compositionend', function() {
            isComposing = false;
            saveState();
            updateCharacterCount();
        });

        // ç›£è½è²¼ä¸Šäº‹ä»¶
        textArea.addEventListener('paste', function() {
            setTimeout(function() {
                saveState();
                updateCharacterCount();
            }, 0);
        });

        // ç›£è½æŒ‰éµ
        textArea.addEventListener('keydown', function(e) {
            if (e.ctrlKey) {
                if (e.key === 'z') {
                    e.preventDefault();
                    undoLastAction(e);
                } else if (e.key === 'y') {
                    e.preventDefault();
                    redoLastAction(e);
                }
            }
        });

        // æ¢å¾©æ‰€æœ‰æŒ‰éˆ•åŠŸèƒ½
        function processTextByLine(prefix, suffix) {
            // ç¢ºä¿ä½¿ç”¨æœ€æ–°çš„é¸å–ç‹€æ…‹
            updateSelectionState();
            
            if (!selectedText) {
                showToast('è«‹å…ˆé¸æ“‡æ–‡å­—', 'warning');
                return;
            }

            // å°‡é¸å–çš„æ–‡å­—åˆ†æˆå¤šè¡Œ
            const lines = selectedText.split('\n');
            
            // è™•ç†æ¯ä¸€è¡Œæ–‡å­—
            const processedText = lines.map(line => {
                if (line.trim() === '') return '';
                // æª¢æŸ¥é€™è¡Œæ˜¯å¦å·²ç¶“æœ‰æ¨™è¨˜
                if (line.startsWith(prefix) && line.endsWith(suffix)) {
                    // å¦‚æœæœ‰ï¼Œç§»é™¤æ¨™è¨˜
                    return line.slice(prefix.length, -suffix.length);
                } else {
                    // å¦‚æœæ²’æœ‰ï¼Œæ·»åŠ æ¨™è¨˜
                    return prefix + line + suffix;
                }
            }).join('\n');  // ç”¨æ›è¡Œç¬¦è™Ÿé€£æ¥è™•ç†å¾Œçš„è¡Œ

            // æ›´æ–°æ–‡æœ¬
            const text = textArea.value;
            textArea.value = text.substring(0, selectionStart) + 
                           processedText + 
                           text.substring(selectionEnd);

            // æ›´æ–°é¸å–ç¯„åœ
            const newEnd = selectionStart + processedText.length;
            textArea.setSelectionRange(selectionStart, newEnd);
            
            // æ›´æ–°ç‹€æ…‹
            updateSelectionState();
            saveState();
            textArea.focus();
        }

        function addHiddenText() {
            processTextByLine('||', '||');
        }

        function addBold() {
            processTextByLine('**', '**');
        }

        function addItalic() {
            processTextByLine('*', '*');
        }

        function addStrikethrough() {
            processTextByLine('~~', '~~');
        }

        function addCode() {
            processTextByLine('`', '`');
        }

        function addCodeBlock() {
            // ç¢ºä¿ä½¿ç”¨æœ€æ–°çš„é¸å–ç‹€æ…‹
            updateSelectionState();
            
            if (!selectedText) {
                showToast('è«‹å…ˆé¸æ“‡æ–‡å­—', 'warning');
                return;
            }

            // å°‡é¸å–çš„æ–‡å­—åˆ†æˆå¤šè¡Œ
            const lines = selectedText.split('\n');
            
            // è™•ç†æ¯ä¸€è¡Œæ–‡å­—
            const processedText = lines.map(line => {
                if (line.trim() === '') return '';
                // æª¢æŸ¥é€™è¡Œæ˜¯å¦å·²ç¶“æœ‰æ¨™è¨˜
                if (line.startsWith('```') && line.endsWith('```')) {
                    // å¦‚æœæœ‰ï¼Œç§»é™¤æ¨™è¨˜
                    return line.slice(3, -3);
                } else {
                    // å¦‚æœæ²’æœ‰ï¼Œæ·»åŠ æ¨™è¨˜
                    return '```' + line + '```';
                }
            }).join('\n');

            // æ›´æ–°æ–‡æœ¬
            const text = textArea.value;
            textArea.value = text.substring(0, selectionStart) + 
                            processedText + 
                            text.substring(selectionEnd);

            // æ›´æ–°é¸å–ç¯„åœ
            const newEnd = selectionStart + processedText.length;
            textArea.setSelectionRange(selectionStart, newEnd);
            
            // æ›´æ–°ç‹€æ…‹
            updateSelectionState();
            saveState();
            textArea.focus();
        }

        function processLinePrefix(prefix) {
            // ç¢ºä¿ä½¿ç”¨æœ€æ–°çš„é¸å–ç‹€æ…‹
            updateSelectionState();
            
            if (!selectedText) {
                showToast('è«‹å…ˆé¸æ“‡æ–‡å­—', 'warning');
                return;
            }

            // å°‡é¸å–çš„æ–‡å­—åˆ†æˆå¤šè¡Œ
            const lines = selectedText.split('\n');
            
            // æª¢æŸ¥ç¬¬ä¸€è¡Œæ˜¯å¦å·²æœ‰å‰ç¶´ï¼Œç”¨ä¾†æ±ºå®šæ˜¯æ·»åŠ é‚„æ˜¯ç§»é™¤
            const shouldRemove = lines[0].startsWith(prefix);
            
            // è™•ç†æ¯ä¸€è¡Œ
            const processedText = lines.map(line => {
                if (shouldRemove && line.startsWith(prefix)) {
                    // å¦‚æœéœ€è¦ç§»é™¤å‰ç¶´ï¼Œåªç§»é™¤å‰ç¶´éƒ¨åˆ†
                    return line.substring(prefix.length);
                } else if (!line.startsWith(prefix)) {
                    // å¦‚æœéœ€è¦æ·»åŠ å‰ç¶´
                    return prefix + line;
                }
                return line;
            }).join('\n');

            // æ›´æ–°æ–‡æœ¬
            const text = textArea.value;
            textArea.value = text.substring(0, selectionStart) + 
                            processedText + 
                            text.substring(selectionEnd);

            // æ›´æ–°é¸å–ç¯„åœ
            const newEnd = selectionStart + processedText.length;
            textArea.setSelectionRange(selectionStart, newEnd);
            
            // æ›´æ–°ç‹€æ…‹
            updateSelectionState();
            saveState();
            textArea.focus();
        }

        function addQuote() {
            processLinePrefix('> ');
        }

        function addParentList() {
            processLinePrefix('- ');
        }

        function addNestedList() {
            const lines = selectedText.split('\n');
            const newText = lines.map((line, index) => {
                if (line.startsWith('- ')) {
                    return line.substring(2);
                } else if (line.startsWith('  - ')) {
                    return line.substring(4);
                }
                return (index === 0 ? '- ' : '  - ') + line;
            }).join('\n');

            const text = textArea.value;
            textArea.value = text.substring(0, selectionStart) + newText + text.substring(selectionEnd);
            
            const newSelectionEnd = selectionStart + newText.length;
            textArea.setSelectionRange(selectionStart, newSelectionEnd);
            selectionEnd = newSelectionEnd;
            selectedText = newText;
            
            textArea.focus();
            saveState();
        }

        function addHeading1() {
            processLinePrefix('# ');
        }

        function addHeading2() {
            processLinePrefix('## ');
        }

        function addHeading3() {
            processLinePrefix('### ');
        }

        // é€šçŸ¥å‡½æ•¸
        function showToast(message, type = 'success') {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.className = `show ${type}`;
            
            // 2ç§’å¾Œéš±è—é€šçŸ¥
            setTimeout(function() {
                toast.className = '';
            }, 2000);
        }

        // æŠ˜ç–Šé¸å–®åŠŸèƒ½
        const leftMenuToggle = document.getElementById('leftMenuToggle');
        const rightMenuToggle = document.getElementById('rightMenuToggle');
        const leftButtonSection = document.getElementById('leftButtonSection');
        const rightButtonSection = document.getElementById('rightButtonSection');

        leftMenuToggle.addEventListener('click', (e) => {
            e.stopPropagation();
            leftMenuToggle.classList.toggle('active');
            leftButtonSection.classList.toggle('active');
            // é—œé–‰å¦ä¸€å´é¸å–®
            rightMenuToggle.classList.remove('active');
            rightButtonSection.classList.remove('active');
        });

        rightMenuToggle.addEventListener('click', (e) => {
            e.stopPropagation();
            rightMenuToggle.classList.toggle('active');
            rightButtonSection.classList.toggle('active');
            // é—œé–‰å¦ä¸€å´é¸å–®
            leftMenuToggle.classList.remove('active');
            leftButtonSection.classList.remove('active');
        });

        // é»æ“Šå…¶ä»–å€åŸŸæ™‚é—œé–‰é¸å–®
        document.addEventListener('click', (e) => {
            if (!e.target.closest('#leftButtonSection') && 
                !e.target.closest('#rightButtonSection') && 
                !e.target.closest('.menu-toggle')) {
                leftMenuToggle.classList.remove('active');
                rightMenuToggle.classList.remove('active');
                leftButtonSection.classList.remove('active');
                rightButtonSection.classList.remove('active');
            }
        });

        // é˜²æ­¢é¸å–®å…§çš„é»æ“Šäº‹ä»¶å†’æ³¡
        leftButtonSection.addEventListener('click', (e) => {
            e.stopPropagation();
        });

        rightButtonSection.addEventListener('click', (e) => {
            e.stopPropagation();
        });

        // æ·»åŠ å­—æ•¸çµ±è¨ˆåŠŸèƒ½
        function updateCharacterCount() {
            const text = textArea.value;
            const whiteSpaceCount = (text.match(/\s/g) || []).length;
            const nonWhiteSpaceCount = text.replace(/\s/g, '').length;
            const totalCount = text.length;

            document.getElementById('whiteSpaceCount').textContent = whiteSpaceCount;
            document.getElementById('nonWhiteSpaceCount').textContent = nonWhiteSpaceCount;
            document.getElementById('totalCount').textContent = totalCount;
        }

        // åœ¨æ–‡æœ¬è®Šæ›´æ™‚æ›´æ–°å­—æ•¸çµ±è¨ˆ
        textArea.addEventListener('input', updateCharacterCount);
        textArea.addEventListener('change', updateCharacterCount);

        // ç¢ºä¿é é¢è¼‰å…¥æ™‚ä¹ŸåŸ·è¡Œä¸€æ¬¡çµ±è¨ˆ
        window.addEventListener('load', function() {
            updateCharacterCount();
        });

        // åœ¨æ‰€æœ‰å¯èƒ½æ”¹è®Šæ–‡æœ¬çš„æ“ä½œå¾Œæ›´æ–°å­—æ•¸çµ±è¨ˆ
        function saveState() {
            const newText = textArea.value;
            if (newText !== currentState) {
                undoStack.push(newText);
                currentState = newText;
                redoStack = [];
                updateCharacterCount();
                
                if (undoStack.length > 100) {
                    undoStack.shift();
                }
            }
        }

        function addNumberList() {
            if (!selectedText) {
                showToast('è«‹å…ˆé¸æ“‡æ–‡å­—', 'warning');
                return;
            }
            document.getElementById('numberListModal').style.display = 'block';
            document.getElementById('startNumber').focus();
        }

        function confirmNumberList() {
            const startNum = parseInt(document.getElementById('startNumber').value) || 1;
            const lines = selectedText.split('\n');
            
            const processedText = lines.map((line, idx) => {
                if (idx === 0) {
                    // ç¬¬ä¸€è¡Œï¼šåŠ ä¸Šæ•¸å­—ç·¨è™Ÿ
                    return `${startNum}. ${line.trim()}`;
                }
                // å¾ŒçºŒè¡Œï¼šåŠ ä¸Š"- "å‰ç¶´
                return `- ${line.trim()}`;
            }).join('\n');

            // æ›´æ–°æ–‡æœ¬
            const text = textArea.value;
            textArea.value = text.substring(0, selectionStart) + 
                           processedText + 
                           text.substring(selectionEnd);
            
            // æ›´æ–°é¸å–ç¯„åœ
            const newEnd = selectionStart + processedText.length;
            textArea.setSelectionRange(selectionStart, newEnd);
            selectionEnd = newEnd;
            selectedText = processedText;
            
            // æ›´æ–°ç‹€æ…‹
            saveState();
            
            // é—œé–‰ modal
            document.getElementById('numberListModal').style.display = 'none';
            document.getElementById('startNumber').value = '1';
            textArea.focus();
        }

        function cancelNumberList() {
            document.getElementById('numberListModal').style.display = 'none';
            document.getElementById('startNumber').value = '1';
            textArea.focus();
        }

        // ç‚ºæ•¸å­—è¼¸å…¥æ¡†æ·»åŠ  Enter éµç¢ºèªåŠŸèƒ½
        document.getElementById('startNumber').addEventListener('keyup', function(event) {
            if (event.key === 'Enter') {
                confirmNumberList();
            }
        });

        // é»æ“Š modal å¤–éƒ¨æ™‚é—œé–‰
        window.onclick = function(event) {
            const numberListModal = document.getElementById('numberListModal');
            if (event.target == numberListModal) {
                numberListModal.style.display = 'none';
                document.getElementById('startNumber').value = '1';
                textArea.focus();
            }
        }

        function addLink() {
            selectedText = textArea.value.substring(selectionStart, selectionEnd);
            if (!selectedText) {
                showToast('è«‹å…ˆé¸æ“‡è¦æ·»åŠ é€£çµçš„æ–‡å­—', 'warning');
                return;
            }
            document.getElementById('linkModal').style.display = 'block';
            document.getElementById('linkInput').value = '';
            document.getElementById('linkInput').focus();
        }

        function confirmLink() {
            const linkUrl = document.getElementById('linkInput').value.trim();
            if (!linkUrl) {
                showToast('è«‹è¼¸å…¥é€£çµç¶²å€', 'warning');
                return;
            }

            const text = textArea.value;
            const linkText = `[${selectedText}](${linkUrl})`;
            textArea.value = text.substring(0, selectionStart) + 
                           linkText + 
                           text.substring(selectionEnd);

            // æ›´æ–°é¸å–ç¯„åœ
            const newEnd = selectionStart + linkText.length;
            textArea.setSelectionRange(selectionStart, newEnd);
            selectionEnd = newEnd;
            selectedText = linkText;

            // é—œé–‰å°è©±æ¡†
            document.getElementById('linkModal').style.display = 'none';
            document.getElementById('linkInput').value = '';

            // æ›´æ–°ç‹€æ…‹
            saveState();
            textArea.focus();
        }

        function cancelLink() {
            document.getElementById('linkModal').style.display = 'none';
            document.getElementById('linkInput').value = '';
            textArea.focus();
        }

        // ç‚ºé€£çµè¼¸å…¥æ¡†æ·»åŠ  Enter éµç¢ºèªåŠŸèƒ½
        document.getElementById('linkInput').addEventListener('keyup', function(event) {
            if (event.key === 'Enter') {
                confirmLink();
            } else if (event.key === 'Escape') {
                cancelLink();
            }
        });

        // é»æ“Šå°è©±æ¡†å¤–éƒ¨æ™‚é—œé–‰
        window.onclick = function(event) {
            const linkModal = document.getElementById('linkModal');
            const numberListModal = document.getElementById('numberListModal');
            if (event.target == linkModal) {
                linkModal.style.display = 'none';
                document.getElementById('linkInput').value = '';
                textArea.focus();
            } else if (event.target == numberListModal) {
                numberListModal.style.display = 'none';
                document.getElementById('startNumber').value = '1';
                textArea.focus();
            }
        }

        // æ·»åŠ å…¨é¸åŠŸèƒ½
        function selectAllText(event) {
            event.preventDefault();
            textArea.select();
            textArea.focus();
            // æ›´æ–°é¸å–ç‹€æ…‹
            updateSelectionState();
        }

        // æ·»åŠ äº‹ä»¶ç›£è½å™¨ä¾†æ›´æ–°é¸å–ç‹€æ…‹
        textArea.addEventListener('mouseup', updateSelectionState);
        textArea.addEventListener('keyup', updateSelectionState);

        // æ›´æ–°é¸å–ç‹€æ…‹çš„å‡½æ•¸
        function updateSelectionState() {
            selectionStart = textArea.selectionStart;
            selectionEnd = textArea.selectionEnd;
            selectedText = textArea.value.substring(selectionStart, selectionEnd);
        }

        function addCodeBlockWhole() {
            // ç¢ºä¿ä½¿ç”¨æœ€æ–°çš„é¸å–ç‹€æ…‹
            updateSelectionState();
            
            if (!selectedText) {
                showToast('è«‹å…ˆé¸æ“‡æ–‡å­—', 'warning');
                return;
            }

            // æª¢æŸ¥é¸å–çš„æ–‡å­—æ˜¯å¦å·²ç¶“æ˜¯ä»£ç¢¼å¡Š
            const isCodeBlock = selectedText.startsWith('```') && selectedText.endsWith('```');
            
            // æ ¹æ“šç•¶å‰ç‹€æ…‹æ±ºå®šæ˜¯æ·»åŠ é‚„æ˜¯ç§»é™¤ä»£ç¢¼å¡Šæ¨™è¨˜
            let processedText;
            if (isCodeBlock) {
                // å¦‚æœå·²ç¶“æ˜¯ä»£ç¢¼å¡Šï¼Œç§»é™¤æ¨™è¨˜
                processedText = selectedText.slice(3, -3);
            } else {
                // å¦‚æœä¸æ˜¯ä»£ç¢¼å¡Šï¼Œæ·»åŠ æ¨™è¨˜
                processedText = '```' + selectedText + '```';
            }

            // æ›´æ–°æ–‡æœ¬
            const text = textArea.value;
            textArea.value = text.substring(0, selectionStart) + 
                            processedText + 
                            text.substring(selectionEnd);

            // æ›´æ–°é¸å–ç¯„åœ
            const newEnd = selectionStart + processedText.length;
            textArea.setSelectionRange(selectionStart, newEnd);
            
            // æ›´æ–°ç‹€æ…‹
            updateSelectionState();
            saveState();
            textArea.focus();
        }
    </script>

</body>
</html>
